import{j as e,B as C,L as O,J as I,u as F,r as f,_ as J}from"./index-B_8ijzOe.js";import{C as R,a as H,d as K}from"./card-DmrTvf1n.js";import{b as M,c as A,d as V,e as T,s as D}from"./InventoryUtils-CuExVan7.js";import{A as q}from"./arrow-left-C1MsaX7l.js";import{S as G}from"./save-xlF0FgKN.js";import{I as w}from"./input-ubP1seug.js";import{L as z}from"./label-7s8BKSBJ.js";import{S as Q,a as W,b as X,c as Y,d as k}from"./select-C9jFBeAQ.js";import{S as Z}from"./search-yXaF56WI.js";import{b as N,e as g,T as ee,a as se,c as v,d as te}from"./table-cuFkCkRr.js";import{R as ae}from"./refresh-cw-CtG-AXzq.js";import"./index-DhyZlU1_.js";import"./chevron-down-K5qyta0R.js";const ne=({title:s,description:m,saveButtonText:c,backButtonText:t,onSave:i})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",size:"icon",asChild:!0,children:e.jsx(O,{to:"/admin/products",children:e.jsx(q,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:s}),e.jsx("p",{className:"text-muted-foreground",children:m})]})]}),e.jsxs(C,{onClick:i,className:"shrink-0",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),c]})]}),re=({searchTerm:s,filterStatus:m,content:c,onSearchChange:t,onStatusFilterChange:i})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(w,{placeholder:c.search,value:s,onChange:d=>t(d.target.value),className:"flex-1"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{htmlFor:"status-filter",className:"mr-2",children:"Filtrar:"}),e.jsxs(Q,{value:m,onValueChange:i,children:[e.jsx(W,{className:"w-[180px]",children:e.jsx(X,{placeholder:"Status"})}),e.jsxs(Y,{children:[e.jsx(k,{value:"all",children:c.filters.all}),e.jsx(k,{value:"in-stock",children:c.filters.inStock}),e.jsx(k,{value:"low-stock",children:c.filters.lowStock}),e.jsx(k,{value:"out-of-stock",children:c.filters.outOfStock})]})]})]})]}),le=({productId:s,sizes:m,sizeStock:c,content:t,onSizeStockChange:i})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:t.stockPerSize}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:m.map(d=>{var x;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(z,{className:"w-16",children:[t.sizeLabel," ",d]}),e.jsx(w,{type:"number",min:"0",value:((x=c[s])==null?void 0:x[d.toString()])||0,onChange:u=>i(s,d.toString(),u.target.value),className:"w-20"})]},`size-${s}-${d}`)})})]}),oe=({product:s,expandedProduct:m,sizeStock:c,content:t,onStockChange:i,onThresholdChange:d,onToggleExpand:x,onSizeStockChange:u})=>{var j;return e.jsxs(e.Fragment,{children:[e.jsxs(N,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>x(s.id),children:[e.jsx(g,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:((j=s.images)==null?void 0:j[0])||"/placeholder.svg",alt:s.name,className:"h-10 w-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.brand})]})]})}),e.jsx(g,{children:s.sku||`SKU-${s.id.padStart(6,"0")}`}),e.jsx(g,{children:e.jsx(w,{type:"number",min:"0",value:s.stock||0,onChange:h=>i(s.id,parseInt(h.target.value)||0),className:"w-20",onClick:h=>h.stopPropagation()})}),e.jsx(g,{children:e.jsx(w,{type:"number",min:"0",value:s.lowStockThreshold||0,onChange:h=>d(s.id,parseInt(h.target.value)||0),className:"w-20",onClick:h=>h.stopPropagation()})}),e.jsx(g,{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M(s.status)}`,children:A(s.status,t)})}),e.jsx(g,{children:e.jsxs(C,{variant:"ghost",size:"sm",className:"h-8",onClick:h=>{h.stopPropagation(),i(s.id,s.stock),I.success(`${s.name} ${t.messages.updateItem}`)},children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),t.buttons.update]})})]},s.id),m===s.id&&s.sizes&&s.sizes.length>0&&e.jsx(N,{className:"bg-muted/30",children:e.jsx(g,{colSpan:6,className:"p-4",children:e.jsx(le,{productId:s.id,sizes:s.sizes,sizeStock:c,content:t,onSizeStockChange:u})})})]})},ie=({filteredProducts:s,expandedProduct:m,sizeStock:c,content:t,onStockChange:i,onThresholdChange:d,onToggleExpand:x,onSizeStockChange:u})=>e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(N,{children:[e.jsx(v,{children:t.columns.product}),e.jsx(v,{children:t.columns.sku}),e.jsx(v,{children:t.columns.stock}),e.jsx(v,{children:t.columns.threshold}),e.jsx(v,{children:t.columns.status}),e.jsx(v,{children:t.columns.actions})]})}),e.jsx(te,{children:s.length>0?s.map(j=>e.jsx(oe,{product:j,expandedProduct:m,sizeStock:c,content:t,onStockChange:i,onThresholdChange:d,onToggleExpand:x,onSizeStockChange:u},j.id)):e.jsx(N,{children:e.jsx(g,{colSpan:6,className:"h-24 text-center",children:t.noProducts})})})]})}),we=()=>{const{language:s}=F(),[m,c]=f.useState(""),[t,i]=f.useState([]),[d,x]=f.useState("all"),[u,j]=f.useState(null),[h,b]=f.useState({}),S=V(s);f.useEffect(()=>{const l=()=>{let n=JSON.parse(localStorage.getItem("inventory")||"[]");if(n.length===0){const o=JSON.parse(localStorage.getItem("products")||"[]");if(o.length===0)try{J(async()=>{const{products:a}=await import("./products-Ij8gCkVX.js");return{products:a}},[]).then(({products:a})=>{n=a.map(p=>({...p,stock:Math.floor(Math.random()*100),lowStockThreshold:10,status:Math.random()>.2?"in-stock":"out-of-stock",sku:`SKU-${p.id.padStart(6,"0")}`})),i(n),localStorage.setItem("inventory",JSON.stringify(n))})}catch(a){console.error("Error loading products:",a)}else n=o.map(a=>({...a,sku:`SKU-${a.id.padStart(6,"0")}`,status:a.stock>0?a.stock<=a.lowStockThreshold?"low-stock":"in-stock":"out-of-stock"})),i(n),localStorage.setItem("inventory",JSON.stringify(n))}else i(n)};l();const r=()=>{l()};return window.addEventListener("inventoryUpdated",r),window.addEventListener("productsUpdated",r),()=>{window.removeEventListener("inventoryUpdated",r),window.removeEventListener("productsUpdated",r)}},[]);const L=t.filter(l=>{var n,o;const r=((n=l.name)==null?void 0:n.toLowerCase().includes(m.toLowerCase()))||((o=l.brand)==null?void 0:o.toLowerCase().includes(m.toLowerCase()));return d==="all"?r:r&&l.status===d}),y=(l,r)=>{i(n=>n.map(o=>{if(o.id===l){const a=T(r,o.lowStockThreshold);return{...o,stock:r,status:a}}return o}))},E=(l,r)=>{i(n=>n.map(o=>{if(o.id===l){const a=T(o.stock,r);return{...o,lowStockThreshold:r,status:a}}return o}))},P=()=>{D(t),I.success(S.messages.saved)},B=l=>{if(u===l)j(null);else{j(l);const r=t.find(n=>n.id===l);if(r&&r.sizes){const n={};r.sizes.forEach(o=>{const a=o.toString();n[a]=Math.floor(r.stock/r.sizes.length)}),b(o=>({...o,[l]:n}))}}},U=(l,r,n)=>{if(b(a=>({...a,[l]:{...a[l],[r]:parseInt(n)||0}})),t.find(a=>a.id===l)){const a={...h[l],[r]:parseInt(n)||0},p=Object.values(a).reduce((_,$)=>_+(Number($)||0),0);y(l,p)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{title:S.title,description:S.description,saveButtonText:S.buttons.save,backButtonText:S.buttons.back,onSave:P}),e.jsxs(R,{children:[e.jsx(H,{className:"pb-3",children:e.jsx(re,{searchTerm:m,filterStatus:d,content:S,onSearchChange:c,onStatusFilterChange:x})}),e.jsx(K,{children:e.jsx(ie,{filteredProducts:L,expandedProduct:u,sizeStock:h,content:S,onStockChange:y,onThresholdChange:E,onToggleExpand:B,onSizeStockChange:U})})]})]})};export{we as default};
